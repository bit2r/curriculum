{
  "hash": "716f4305e61d54183688bd1e752b1fe9",
  "result": {
    "markdown": "---\ntitle: \"데이터 전처리 : 파이썬\"\ndescription: \"데이터 전처리 (Preprocessing)를 구성하는 기계학습과 시각화를 위한 다양한 데이터 정제(Cleansing)하는 방법을 다룹니다.\"\ndate: today # 날짜 설정: now, last-modified\nauthor:\n  - name: 이광춘\n    affiliation: TCS\ntitle-block-banner: false\nformat:\n  html:\n    theme: \n      - flatly\n      - css/quarto-fonts.css\n    code-fold: false\n    code-overflow: scroll\n    toc: true\n    toc-depth: 3\n    number-sections: true\n    highlight-style: github    \n    self-contained: false\neditor_options: \n  chunk_output_type: console\nknitr:\n  opts_chunk: \n    collapse: true\n    comment: \"#>\" \n    R.options:\n      knitr.graphics.auto_pdf: true  \n---\n\n\n\n\n# 데이터셋\n\n[palmerpenguins](https://github.com/mcnakhaee/palmerpenguins) 데이터셋을 파이썬 데이터 패키지로 구현되어 있어 이를 설치하여 불러 실습에 사용한다.\n\n````bash\n$ pip3 install palmerpenguins\n````\n\n\n\n# 결측값 제거\n\n[참고자료: [결측데이터](https://aispiration.com/data-science/ds-missing.html)]{.aside}\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.python .cell-code}\nimport numpy as np\nimport pandas as pd\nfrom palmerpenguins import load_penguins\n\npenguins\n```\n:::\n\n::: {.cell}\n\n```\n#>   species     island  bill_length_mm  ...  body_mass_g     sex  year\n#> 0  Adelie  Torgersen            39.1  ...       3750.0    male  2007\n#> 1  Adelie  Torgersen            39.5  ...       3800.0  female  2007\n#> 2  Adelie  Torgersen            40.3  ...       3250.0  female  2007\n#> 3  Adelie  Torgersen             NaN  ...          NaN     NaN  2007\n#> 4  Adelie  Torgersen            36.7  ...       3450.0  female  2007\n#> \n#> [5 rows x 8 columns]\n```\n:::\n\n:::\n\n## 행기준 제거\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.python .cell-code}\npenguins \\\n  .dropna()\n```\n:::\n\n::: {.cell}\n\n```\n#>        species     island  bill_length_mm  ...  body_mass_g     sex  year\n#> 0       Adelie  Torgersen            39.1  ...       3750.0    male  2007\n#> 1       Adelie  Torgersen            39.5  ...       3800.0  female  2007\n#> 2       Adelie  Torgersen            40.3  ...       3250.0  female  2007\n#> 4       Adelie  Torgersen            36.7  ...       3450.0  female  2007\n#> 5       Adelie  Torgersen            39.3  ...       3650.0    male  2007\n#> ..         ...        ...             ...  ...          ...     ...   ...\n#> 339  Chinstrap      Dream            55.8  ...       4000.0    male  2009\n#> 340  Chinstrap      Dream            43.5  ...       3400.0  female  2009\n#> 341  Chinstrap      Dream            49.6  ...       3775.0    male  2009\n#> 342  Chinstrap      Dream            50.8  ...       4100.0    male  2009\n#> 343  Chinstrap      Dream            50.2  ...       3775.0  female  2009\n#> \n#> [333 rows x 8 columns]\n```\n:::\n\n\n:::\n\n\n## 열기준 제거\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.python .cell-code}\npenguins \\\n  .dropna(axis = 1)\n```\n:::\n\n::: {.cell}\n\n```\n#>        species     island  year\n#> 0       Adelie  Torgersen  2007\n#> 1       Adelie  Torgersen  2007\n#> 2       Adelie  Torgersen  2007\n#> 3       Adelie  Torgersen  2007\n#> 4       Adelie  Torgersen  2007\n#> ..         ...        ...   ...\n#> 339  Chinstrap      Dream  2009\n#> 340  Chinstrap      Dream  2009\n#> 341  Chinstrap      Dream  2009\n#> 342  Chinstrap      Dream  2009\n#> 343  Chinstrap      Dream  2009\n#> \n#> [344 rows x 3 columns]\n```\n:::\n\n\n:::\n\n\n\n## 결측값 현황\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.python .cell-code}\nnan_sum = penguins.isna().sum()\n\ntype(nan_sum)\n\nnan_df = nan_sum.to_frame(name = \"결측값\")\n\n# nan_df = pd.DataFrame(nan_sum).rename(columns = {0:'결측값'})\n\n\npenguins_nrow = penguins.shape[0]\n\nnan_df \\\n .assign(결측비율 = nan_df['결측값'] / penguins_nrow)\n```\n:::\n\n::: {.cell}\n\n```\n#> <class 'pandas.core.series.Series'>\n#>                    결측값\n#> species              0\n#> island               0\n#> bill_length_mm       2\n#> bill_depth_mm        2\n#> flipper_length_mm    2\n#> body_mass_g          2\n#> sex                 11\n#> year                 0\n#>                    결측값      결측비율\n#> species              0  0.000000\n#> island               0  0.000000\n#> bill_length_mm       2  0.005814\n#> bill_depth_mm        2  0.005814\n#> flipper_length_mm    2  0.005814\n#> body_mass_g          2  0.005814\n#> sex                 11  0.031977\n#> year                 0  0.000000\n```\n:::\n\n\n:::\n\n\n# 중복 제거\n\n## 행기준 제거\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.python .cell-code}\npenguins_dup = penguins \\\n  .loc[:, [\"species\", \"island\", \"bill_length_mm\", \"bill_depth_mm\"]] \n\npenguins_dup_mask = penguins_dup \\\n  .duplicated(keep = \"first\")\n\npenguins_dup[penguins_dup_mask]\n\npenguins [(penguins['species'] == \"Adelie\") &\n          (penguins['island']  == \"Biscoe\") &\n          (penguins['bill_length_mm']  == 35.0) &\n          (penguins['bill_depth_mm']  == 17.9)]\n```\n:::\n\n::: {.cell}\n\n```\n#>     species  island  bill_length_mm  bill_depth_mm\n#> 100  Adelie  Biscoe            35.0           17.9\n#> 104  Adelie  Biscoe            37.9           18.6\n#> 184  Gentoo  Biscoe            45.1           14.5\n#> 199  Gentoo  Biscoe            50.5           15.9\n#>     species  island  bill_length_mm  ...  body_mass_g     sex  year\n#> 52   Adelie  Biscoe            35.0  ...       3450.0  female  2008\n#> 100  Adelie  Biscoe            35.0  ...       3725.0  female  2009\n#> \n#> [2 rows x 8 columns]\n```\n:::\n\n:::\n\n\n## 열기준 제거\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.python .cell-code}\npenguins_dup_df = pd.concat([penguins[['species', 'island']], penguins['species']], axis=1)\n\npenguins_dup_df.columns.duplicated()\n\npenguins_dup_df.loc[:,~penguins_dup_df.columns.duplicated()]\n```\n:::\n\n::: {.cell}\n\n```\n#> array([False, False,  True])\n#>        species     island\n#> 0       Adelie  Torgersen\n#> 1       Adelie  Torgersen\n#> 2       Adelie  Torgersen\n#> 3       Adelie  Torgersen\n#> 4       Adelie  Torgersen\n#> ..         ...        ...\n#> 339  Chinstrap      Dream\n#> 340  Chinstrap      Dream\n#> 341  Chinstrap      Dream\n#> 342  Chinstrap      Dream\n#> 343  Chinstrap      Dream\n#> \n#> [344 rows x 2 columns]\n```\n:::\n\n:::\n\n\n# 자료형 변환\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.python .cell-code}\npenguins['year'] = pd.to_datetime(penguins['year'], format='%Y')\n\npenguins \\\n  .loc[:, [\"species\", \"year\", \"island\", \"bill_length_mm\"]]\n```\n:::\n\n::: {.cell}\n\n```\n#>        species       year     island  bill_length_mm\n#> 0       Adelie 2007-01-01  Torgersen            39.1\n#> 1       Adelie 2007-01-01  Torgersen            39.5\n#> 2       Adelie 2007-01-01  Torgersen            40.3\n#> 3       Adelie 2007-01-01  Torgersen             NaN\n#> 4       Adelie 2007-01-01  Torgersen            36.7\n#> ..         ...        ...        ...             ...\n#> 339  Chinstrap 2009-01-01      Dream            55.8\n#> 340  Chinstrap 2009-01-01      Dream            43.5\n#> 341  Chinstrap 2009-01-01      Dream            49.6\n#> 342  Chinstrap 2009-01-01      Dream            50.8\n#> 343  Chinstrap 2009-01-01      Dream            50.2\n#> \n#> [344 rows x 4 columns]\n```\n:::\n\n\n:::\n\n\n# 이상점 제거\n\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.python .cell-code}\nbill_mean = penguins[\"bill_length_mm\"].mean()\nbill_sd = penguins[\"bill_length_mm\"].std()  \n\npenguins \\\n  .loc[(penguins[\"bill_length_mm\"] < bill_mean - 2 * bill_sd) | \\\n       (penguins[\"bill_length_mm\"] > bill_mean + 2 * bill_sd), :]\n\n```\n:::\n\n::: {.cell}\n\n```\n#>        species  island  bill_length_mm  ...  body_mass_g     sex       year\n#> 142     Adelie   Dream            32.1  ...       3050.0  female 2009-01-01\n#> 185     Gentoo  Biscoe            59.6  ...       6050.0    male 2007-01-01\n#> 253     Gentoo  Biscoe            55.9  ...       5600.0    male 2009-01-01\n#> 267     Gentoo  Biscoe            55.1  ...       5850.0    male 2009-01-01\n#> 293  Chinstrap   Dream            58.0  ...       3700.0  female 2007-01-01\n#> 339  Chinstrap   Dream            55.8  ...       4000.0    male 2009-01-01\n#> \n#> [6 rows x 8 columns]\n```\n:::\n\n\n:::\n\n# 공백문자제거\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.python .cell-code}\npenguins \\\n  .assign(species=lambda x: x[\"species\"].str.strip())\n\n```\n:::\n\n::: {.cell}\n\n```\n#>        species     island  bill_length_mm  ...  body_mass_g     sex       year\n#> 0       Adelie  Torgersen            39.1  ...       3750.0    male 2007-01-01\n#> 1       Adelie  Torgersen            39.5  ...       3800.0  female 2007-01-01\n#> 2       Adelie  Torgersen            40.3  ...       3250.0  female 2007-01-01\n#> 3       Adelie  Torgersen             NaN  ...          NaN     NaN 2007-01-01\n#> 4       Adelie  Torgersen            36.7  ...       3450.0  female 2007-01-01\n#> ..         ...        ...             ...  ...          ...     ...        ...\n#> 339  Chinstrap      Dream            55.8  ...       4000.0    male 2009-01-01\n#> 340  Chinstrap      Dream            43.5  ...       3400.0  female 2009-01-01\n#> 341  Chinstrap      Dream            49.6  ...       3775.0    male 2009-01-01\n#> 342  Chinstrap      Dream            50.8  ...       4100.0    male 2009-01-01\n#> 343  Chinstrap      Dream            50.2  ...       3775.0  female 2009-01-01\n#> \n#> [344 rows x 8 columns]\n```\n:::\n\n\n:::\n\n:::{.callout-note}\n### `strip()` 메쏘드\n\n\n::: {.cell}\n\n```{.python .cell-code}\ntext = ' _ 대한민국 화이팅!!! _ '\nprint('[' + text.rstrip() + ']')\n#> [ _ 대한민국 화이팅!!! _]\nprint('[' + text.lstrip() + ']')\n#> [_ 대한민국 화이팅!!! _ ]\nprint('[' + text.strip() + ']')\n#> [_ 대한민국 화이팅!!! _]\n```\n:::\n\n\n:::\n\n\n# 칼럼 변환\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.python .cell-code}\ndef toupper(x):\n    return x.str.upper()\n\npenguins \\\n  .apply(lambda x: toupper(x) if x.dtype == \"object\" else x)\n```\n:::\n\n::: {.cell}\n\n```\n#>        species     island  bill_length_mm  ...  body_mass_g     sex       year\n#> 0       ADELIE  TORGERSEN            39.1  ...       3750.0    MALE 2007-01-01\n#> 1       ADELIE  TORGERSEN            39.5  ...       3800.0  FEMALE 2007-01-01\n#> 2       ADELIE  TORGERSEN            40.3  ...       3250.0  FEMALE 2007-01-01\n#> 3       ADELIE  TORGERSEN             NaN  ...          NaN     NaN 2007-01-01\n#> 4       ADELIE  TORGERSEN            36.7  ...       3450.0  FEMALE 2007-01-01\n#> ..         ...        ...             ...  ...          ...     ...        ...\n#> 339  CHINSTRAP      DREAM            55.8  ...       4000.0    MALE 2009-01-01\n#> 340  CHINSTRAP      DREAM            43.5  ...       3400.0  FEMALE 2009-01-01\n#> 341  CHINSTRAP      DREAM            49.6  ...       3775.0    MALE 2009-01-01\n#> 342  CHINSTRAP      DREAM            50.8  ...       4100.0    MALE 2009-01-01\n#> 343  CHINSTRAP      DREAM            50.2  ...       3775.0  FEMALE 2009-01-01\n#> \n#> [344 rows x 8 columns]\n```\n:::\n\n\n:::\n\n\n# 특정문자 변환\n\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.python .cell-code}\npenguins \\\n  .assign(species_kr = lambda x: x[\"species\"] + \"_종\") \\\n  .loc[:, [\"species\", \"species_kr\", \"island\"]]\n```\n:::\n\n::: {.cell}\n\n```\n#>        species   species_kr     island\n#> 0       Adelie     Adelie_종  Torgersen\n#> 1       Adelie     Adelie_종  Torgersen\n#> 2       Adelie     Adelie_종  Torgersen\n#> 3       Adelie     Adelie_종  Torgersen\n#> 4       Adelie     Adelie_종  Torgersen\n#> ..         ...          ...        ...\n#> 339  Chinstrap  Chinstrap_종      Dream\n#> 340  Chinstrap  Chinstrap_종      Dream\n#> 341  Chinstrap  Chinstrap_종      Dream\n#> 342  Chinstrap  Chinstrap_종      Dream\n#> 343  Chinstrap  Chinstrap_종      Dream\n#> \n#> [344 rows x 3 columns]\n```\n:::\n\n\n:::\n\n\n# 결측값 치환\n\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.python .cell-code}\nmean_bill_length = penguins[\"bill_length_mm\"].mean()\n\npenguins \\\n  .assign(bill_length_mm = lambda x: x[\"bill_length_mm\"].fillna(mean_bill_length))\n```\n:::\n\n::: {.cell}\n\n```\n#>        species     island  bill_length_mm  ...  body_mass_g     sex       year\n#> 0       Adelie  Torgersen        39.10000  ...       3750.0    male 2007-01-01\n#> 1       Adelie  Torgersen        39.50000  ...       3800.0  female 2007-01-01\n#> 2       Adelie  Torgersen        40.30000  ...       3250.0  female 2007-01-01\n#> 3       Adelie  Torgersen        43.92193  ...          NaN     NaN 2007-01-01\n#> 4       Adelie  Torgersen        36.70000  ...       3450.0  female 2007-01-01\n#> ..         ...        ...             ...  ...          ...     ...        ...\n#> 339  Chinstrap      Dream        55.80000  ...       4000.0    male 2009-01-01\n#> 340  Chinstrap      Dream        43.50000  ...       3400.0  female 2009-01-01\n#> 341  Chinstrap      Dream        49.60000  ...       3775.0    male 2009-01-01\n#> 342  Chinstrap      Dream        50.80000  ...       4100.0    male 2009-01-01\n#> 343  Chinstrap      Dream        50.20000  ...       3775.0  female 2009-01-01\n#> \n#> [344 rows x 8 columns]\n```\n:::\n\n\n:::\n\n\n# Pivoting\n\n폭넓은 데이터(wide-format data)를 긴 데이터(long-format data)로 혹은 반대로 데이터의 형태를 바꾼다.\n\n## Wide &rarr; Long\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.python .cell-code}\npenguins_long = pd.melt(penguins, id_vars=[\"species\"], \n                        value_vars = penguins.columns[penguins.columns.str.contains(\"mm\")], \n                        var_name   = \"측정변수\", \n                        value_name = \"측정값\")\n\npenguins_long\n```\n:::\n\n::: {.cell}\n\n```\n#>         species               측정변수    측정값\n#> 0        Adelie     bill_length_mm   39.1\n#> 1        Adelie     bill_length_mm   39.5\n#> 2        Adelie     bill_length_mm   40.3\n#> 3        Adelie     bill_length_mm    NaN\n#> 4        Adelie     bill_length_mm   36.7\n#> ...         ...                ...    ...\n#> 1027  Chinstrap  flipper_length_mm  207.0\n#> 1028  Chinstrap  flipper_length_mm  202.0\n#> 1029  Chinstrap  flipper_length_mm  193.0\n#> 1030  Chinstrap  flipper_length_mm  210.0\n#> 1031  Chinstrap  flipper_length_mm  198.0\n#> \n#> [1032 rows x 3 columns]\n```\n:::\n\n\n:::\n\n\n## long &rarr; Wide\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.python .cell-code}\npenguins_long.reset_index().pivot_table(index   = \"species\", \n                    columns = \"측정변수\", \n                    values  = \"측정값\",\n                    aggfunc = 'mean')\n```\n:::\n\n::: {.cell}\n\n```\n#> 측정변수       bill_depth_mm  bill_length_mm  flipper_length_mm\n#> species                                                    \n#> Adelie         18.346358       38.791391         189.953642\n#> Chinstrap      18.420588       48.833824         195.823529\n#> Gentoo         14.982114       47.504878         217.186992\n```\n:::\n\n\n:::\n\n\n# 변수 쪼개기\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.python .cell-code}\nextracted = penguins_long[\"측정변수\"].str.extract(r\"([a-z]+?)_([a-z]+?)_(mm)\", expand=True)\nextracted.columns = [\"부위\", \"측정\", \"단위\"]\n\npenguins_long.assign(**extracted)\n```\n:::\n\n::: {.cell}\n\n```\n#>         species               측정변수    측정값       부위      측정  단위\n#> 0        Adelie     bill_length_mm   39.1     bill  length  mm\n#> 1        Adelie     bill_length_mm   39.5     bill  length  mm\n#> 2        Adelie     bill_length_mm   40.3     bill  length  mm\n#> 3        Adelie     bill_length_mm    NaN     bill  length  mm\n#> 4        Adelie     bill_length_mm   36.7     bill  length  mm\n#> ...         ...                ...    ...      ...     ...  ..\n#> 1027  Chinstrap  flipper_length_mm  207.0  flipper  length  mm\n#> 1028  Chinstrap  flipper_length_mm  202.0  flipper  length  mm\n#> 1029  Chinstrap  flipper_length_mm  193.0  flipper  length  mm\n#> 1030  Chinstrap  flipper_length_mm  210.0  flipper  length  mm\n#> 1031  Chinstrap  flipper_length_mm  198.0  flipper  length  mm\n#> \n#> [1032 rows x 6 columns]\n```\n:::\n\n\n:::\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}