{
  "hash": "19b12b5d2bf908e1a3eb0292ebc2828a",
  "result": {
    "markdown": "---\ntitle: \"MLOps\"\ndescription: \"WSL 리눅스 배포\"\ndate: today # 날짜 설정: now, last-modified\nauthor:\n  - name: 이광춘\n    affiliation: TCS\ntitle-block-banner: false\nformat:\n  html:\n    theme: \n      - flatly\n      - css/quarto-fonts.css\n    code-fold: true\n    code-overflow: wrap\n    toc: true\n    toc-depth: 3\n    number-sections: true\n    highlight-style: pygments \n    self-contained: false\neditor_options: \n  chunk_output_type: console\nknitr:\n  opts_chunk: \n    collapse: true\n    comment: \"#>\" \n    R.options:\n      knitr.graphics.auto_pdf: true  \nfilters:\n   - lightbox\n   - include-code-files\nlightbox: auto      \n---\n\n\n\n# WSL 리눅스\n\n윈도우에서 리눅스를 사용하는 방식은 진화를 거듭했지만 최근에는 Microsoft Store에서 `ubuntu` 리눅스를 앱 사용하듯이 설치해서 사용하면 된다.\n\n[[데이터 과학 : 윈도우 10 - WSL (우분투 배쉬), 2019년 경](https://statkclee.github.io/data-science/ds-windows-bash.html)]{.aside}\n\n![](fig/wsl_ubuntu.png)\n\n## 로컬 디렉토리\n\n`/mnt/` 디렉토리 아래 `C:\\`, `D:\\` 드라이브를 찾을 수 있고 그 아래 작업 디렉토리와 파일로 이동하면 후속 작업을 이어서 수행할 수 있다.\n\n```bash\nstatkclee@dl:/mnt/d/tcs/curriculum/mlops$ cd /mnt/\nstatkclee@dl:/mnt$ ls\nc  d  wsl\nstatkclee@dl:/mnt$ cd d/tcs/curriculum/mlops/\nstatkclee@dl:/mnt/d/tcs/curriculum/mlops$ pwd\n/mnt/d/tcs/curriculum/mlops\n```\n\n![](fig/penguins-pip.png)\n\n# 암수 기계학습 모형\n\n파머 펭귄 데이터를 사용하여 Random Forest 기계학습 예측모형을 사용하여 성별 예측 기계학습 모형을 파이썬 `sk-learn`, `numpy`, `pandas` 패키지를 사용해서 구축해보자. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(reticulate)\n\nreticulate::source_python(\"mlops/vanilla/penguins.py\")\n\npy$accuracy\n#> [1] 0.8208955\n```\n:::\n\n\n## 파이썬 코드\n\n패키지 상단에 설치하고 파머펭귄 패키지 데이터를 가져와서 \n결측값 제거하고 기계학습 관련 훈련/시험 데이터 나누고,\nRandom Forest 예측모형으로 성별 예측 모형 개발하고 시험데이터로 \n성별 예측모형 정확도를 측정한다.\n\n```{.python include=\"mlops/vanilla/penguins.py\"}\n```\n\n## 실제 배포환경\n\n개발환경에서 성별예측모형을 개발했지만 이를 배포하게 되면 배포될 컴퓨터에는 관련 패키지가 설치되어 있지 않다. 그렇다고 수작업으로 `requirements.txt` 파일에 관련 패키지를 수작업으로 일일이 넣을 수는 없다.\n\n## `pipreqs` 패키지\n\n`pipreqs` 패키지는 `pip freeze` 명령어와 비교하여 해당 프로젝트(디렉토리)의 \n파이썬 패키지만 `requirements.txt` 파일에 담아낸다.\n\n```bash\nstatkclee@dl:/mnt/d/tcs/curriculum/mlops/vanilla$ pip install pipreqs\nDefaulting to user installation because normal site-packages is not writeable\nRequirement already satisfied: pipreqs in /home/statkclee/.local/lib/python3.10/site-packages (0.4.11)\nRequirement already satisfied: yarg in /home/statkclee/.local/lib/python3.10/site-packages (from pipreqs) (0.1.9)\nRequirement already satisfied: docopt in /home/statkclee/.local/lib/python3.10/site-packages (from pipreqs) (0.6.2)\nRequirement already satisfied: requests in /home/statkclee/.local/lib/python3.10/site-packages (from yarg->pipreqs) (2.28.2)\nRequirement already satisfied: idna<4,>=2.5 in /home/statkclee/.local/lib/python3.10/site-packages (from requests->yarg->pipreqs) (3.4)\nRequirement already satisfied: urllib3<1.27,>=1.21.1 in /home/statkclee/.local/lib/python3.10/site-packages (from requests->yarg->pipreqs) (1.26.14)\nRequirement already satisfied: certifi>=2017.4.17 in /home/statkclee/.local/lib/python3.10/site-packages (from requests->yarg->pipreqs) (2022.12.7)\nRequirement already satisfied: charset-normalizer<4,>=2 in /home/statkclee/.local/lib/python3.10/site-packages (from requests->yarg->pipreqs) (3.0.1)\n```\n\n## 패키지 설치\n\n`pip install -r requirements.txt` 명령어로 암수성별 예측 기계학습모형 개발에 사용된\n패키지를 일괄 설치할 수 있다.\n\n```bash\nstatkclee@dl:/mnt/d/tcs/curriculum/mlops/vanilla$ pipreqs .\nstatkclee@dl:/mnt/d/tcs/curriculum/mlops/vanilla$ ls\npenguins.py  requirements.txt\n\nstatkclee@dl:/mnt/d/tcs/curriculum/mlops/vanilla$ pip install -r requirements.txt\nDefaulting to user installation because normal site-packages is not writeable\nRequirement already satisfied: numpy==1.24.2 in /home/statkclee/.local/lib/python3.10/site-packages (from -r requirements.txt (line 1)) (1.24.2)\nCollecting palmerpenguins==0.1.4\n  Downloading palmerpenguins-0.1.4-py3-none-any.whl (17 kB)\nCollecting pandas==1.5.3\n  Downloading pandas-1.5.3-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (12.1 MB)\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 12.1/12.1 MB 11.3 MB/s eta 0:00:00\nCollecting scikit_learn==1.2.1\n  Downloading scikit_learn-1.2.1-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (9.6 MB)\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 9.6/9.6 MB 11.4 MB/s eta 0:00:00\nCollecting pytz>=2020.1\n  Downloading pytz-2022.7.1-py2.py3-none-any.whl (499 kB)\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 499.4/499.4 kB 10.3 MB/s eta 0:00:00\nCollecting python-dateutil>=2.8.1\n  Downloading python_dateutil-2.8.2-py2.py3-none-any.whl (247 kB)\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 247.7/247.7 kB 9.7 MB/s eta 0:00:00\nCollecting scipy>=1.3.2\n  Downloading scipy-1.10.1-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (34.4 MB)\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 34.4/34.4 MB 10.9 MB/s eta 0:00:00\nCollecting joblib>=1.1.1\n  Downloading joblib-1.2.0-py3-none-any.whl (297 kB)\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 298.0/298.0 kB 9.8 MB/s eta 0:00:00\nCollecting threadpoolctl>=2.0.0\n  Downloading threadpoolctl-3.1.0-py3-none-any.whl (14 kB)\nRequirement already satisfied: six>=1.5 in /usr/lib/python3/dist-packages (from python-dateutil>=2.8.1->pandas==1.5.3->-r requirements.txt (line 3)) (1.16.0)\nInstalling collected packages: pytz, threadpoolctl, scipy, python-dateutil, joblib, scikit_learn, pandas, palmerpenguins\nSuccessfully installed joblib-1.2.0 palmerpenguins-0.1.4 pandas-1.5.3 python-dateutil-2.8.2 pytz-2022.7.1 scikit_learn-1.2.1 scipy-1.10.1 threadpoolctl-3.1.0\n```\n\n## 실행\n\n`python3 penguins.py` 명령어로 개발환경에서 제작한 암수성별 예측모형을 성공적으로 배포함을 확인할 수 있다.\n\n```bash\nstatkclee@dl:/mnt/d/tcs/curriculum/mlops/vanilla$ python3 penguins.py\n정확도(Accuracy): 0.835820895522388\n```\n\n\n# 파이프라인 기계학습\n\n기계학습 파이프라인을 구축하여 암수성별 예측모형을 개발한다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(reticulate)\n\nreticulate::source_python(\"mlops/pipeline/penguins_pipeline.py\")\n\npy$accuracy\n#> [1] 0.8358209\n```\n:::\n\n\n## 파이썬 코드\n\nFeature Engineering과 예측모형을 `Pipeline()` 함수에 넣어 체계화한다.\n\n```{.python include=\"mlops/pipeline/penguins_pipeline.py\"}\n```\n\n## 실행\n\n`python3 penguins_pipeline.py` 명령어로 개발환경에서 파이프라인 방식을 적용하여 제작한 암수성별 예측모형을 성공적으로 배포함을 확인할 수 있다.\n\n```bash\nstatkclee@dl:/mnt/d/tcs/curriculum/mlops/pipeline$ python3 penguins_pipeline.py\n파이프라인 방식 정확도(Accuracy): 0.8507462686567164\n```\n\n# 객체지향 기계학습\n\n기계학습모형을 객체지향 클래스로 구축하여 암수성별 예측모형을 클래스로 개발하여 적용시킨다.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(reticulate)\n\nreticulate::source_python(\"mlops/oop/penguins_oop.py\")\n\npy$accuracy\n#> [1] 0.8358209\n```\n:::\n\n\n## 파이썬 코드\n\n객체지향 `PenguinSexClassifier` 클래스를 생성하여 기계학습 예측모형을 제작할 수 있다.\n\n```{.python include=\"mlops/oop/penguins_oop.py\"}\n```\n\n## 실행\n\n`python3 ` 명령어로 개발환경에서 객체지향 방식으로 개발한 클래스 방식을 적용하여 제작한 암수성별 예측모형을 성공적으로 배포함을 확인할 수 있다.\n\n```bash\nstatkclee@dl:/mnt/d/tcs/curriculum/mlops/oop$ python3 penguins_oop.py\nOOP 정확도(Accuracy): 0.8656716417910447\n```\n\n# `Makefile` 자동화\n\n## 파이썬 파일\n\n암수성별 예측모형 정확도를 텍스트 파일에 저장하는 로직을 추가한다.\n이를 통해 `requirements.txt` 파일을 저장시킨다.\n\n```{.python include=\"mlops/makefile/penguins_pipeline.py\"}\n```\n\n## `Makefile`\n\n자동화 대상을 다음과 같이 정리한다.\n\n1. `make requirements` : 파이썬 패키지 설치 목록을 `requirements.txt` 에 작성한다.\n1. `make install` : `requirements.txt` 파일에 저장된 패키지를 설치한다.\n1. `make run` : 암수성별 예측모형을 실행하고 예측정확도를 `results.txt` 파일에 기록한다.\n\n```{.python include=\"mlops/makefile/Makefile\"}\n```\n\n## 작업 예시\n\n\n::: {.cell}\n\n```{.bash .cell-code}\nstatkclee@dl:/mnt/d/tcs/curriculum/mlops/makefile$ make help\nUsage: make [target]\n\nTargets:\n  help            Show this help message\n  all              Install dependencies and run the script\n  requirements  Generate requirements.txt using pipreqs\n  install          Install dependencies\n  run              Run the script\n  clean          Clean up the project directory\n\nstatkclee@dl:/mnt/d/tcs/curriculum/mlops/makefile$ make requirements\npip3 install pipreqs\nDefaulting to user installation because normal site-packages is not writeable\nRequirement already satisfied: pipreqs in /home/statkclee/.local/lib/python3.10/site-packages (0.4.11)\nRequirement already satisfied: docopt in /home/statkclee/.local/lib/python3.10/site-packages (from pipreqs) (0.6.2)\nRequirement already satisfied: yarg in /home/statkclee/.local/lib/python3.10/site-packages (from pipreqs) (0.1.9)\nRequirement already satisfied: requests in /home/statkclee/.local/lib/python3.10/site-packages (from yarg->pipreqs) (2.28.2)\nRequirement already satisfied: urllib3<1.27,>=1.21.1 in /home/statkclee/.local/lib/python3.10/site-packages (from requests->yarg->pipreqs) (1.26.14)\nRequirement already satisfied: charset-normalizer<4,>=2 in /home/statkclee/.local/lib/python3.10/site-packages (from requests->yarg->pipreqs) (3.0.1)\nRequirement already satisfied: certifi>=2017.4.17 in /home/statkclee/.local/lib/python3.10/site-packages (from requests->yarg->pipreqs) (2022.12.7)\nRequirement already satisfied: idna<4,>=2.5 in /home/statkclee/.local/lib/python3.10/site-packages (from requests->yarg->pipreqs) (3.4)\npipreqs --force .\nINFO: Successfully saved requirements file in ./requirements.txt\n\nstatkclee@dl:/mnt/d/tcs/curriculum/mlops/makefile$ make install\npip3 install -r requirements.txt\nDefaulting to user installation because normal site-packages is not writeable\nRequirement already satisfied: numpy==1.24.2 in /home/statkclee/.local/lib/python3.10/site-packages (from -r requirements.txt (line 1)) (1.24.2)\nRequirement already satisfied: palmerpenguins==0.1.4 in /home/statkclee/.local/lib/python3.10/site-packages (from -r requirements.txt (line 2)) (0.1.4)\nRequirement already satisfied: pandas==1.5.3 in /home/statkclee/.local/lib/python3.10/site-packages (from -r requirements.txt (line 3)) (1.5.3)\nRequirement already satisfied: scikit_learn==1.2.1 in /home/statkclee/.local/lib/python3.10/site-packages (from -r requirements.txt (line 4)) (1.2.1)\nRequirement already satisfied: pytz>=2020.1 in /home/statkclee/.local/lib/python3.10/site-packages (from pandas==1.5.3->-r requirements.txt (line 3)) (2022.7.1)\nRequirement already satisfied: python-dateutil>=2.8.1 in /home/statkclee/.local/lib/python3.10/site-packages (from pandas==1.5.3->-r requirements.txt (line 3)) (2.8.2)\nRequirement already satisfied: scipy>=1.3.2 in /home/statkclee/.local/lib/python3.10/site-packages (from scikit_learn==1.2.1->-r requirements.txt (line 4)) (1.10.1)\nRequirement already satisfied: joblib>=1.1.1 in /home/statkclee/.local/lib/python3.10/site-packages (from scikit_learn==1.2.1->-r requirements.txt (line 4)) (1.2.0)\nRequirement already satisfied: threadpoolctl>=2.0.0 in /home/statkclee/.local/lib/python3.10/site-packages (from scikit_learn==1.2.1->-r requirements.txt (line 4)) (3.1.0)\nRequirement already satisfied: six>=1.5 in /usr/lib/python3/dist-packages (from python-dateutil>=2.8.1->pandas==1.5.3->-r requirements.txt (line 3)) (1.16.0)\n\nstatkclee@dl:/mnt/d/tcs/curriculum/mlops/makefile$ make run\npython3 penguins_pipeline.py\n파이프라인 방식 정확도(Accuracy): 0.835820895522388\n\nstatkclee@dl:/mnt/d/tcs/curriculum/mlops/makefile$ ls\nMakefile  penguins_pipeline.py  requirements.txt  results.txt\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}