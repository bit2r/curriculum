{
  "hash": "e4b68b9cdf7792f0472fb2bb5191a081",
  "result": {
    "markdown": "---\ntitle: \"펭균 ML 보고서\"\ndescription: \"펭귄 암수예측 기계학습모형 개발 보고서\"\ndate: today # 날짜 설정: now, last-modified\nauthor:\n  - name: 이광춘\n    affiliation: TCS\ntitle-block-banner: false\nformat:\n  html:\n    theme: \n      - flatly\n      - css/quarto-fonts.css\n    code-fold: false\n    code-overflow: scroll\n    toc: true\n    toc-depth: 3\n    number-sections: true\n    highlight-style: github    \n    self-contained: false\neditor_options: \n  chunk_output_type: console\nknitr:\n  opts_chunk: \n    collapse: true\n    comment: \"#>\" \n    R.options:\n      knitr.graphics.auto_pdf: true  \nfilters:\n   - lightbox\nlightbox: auto      \n---\n\n\n\n# 들어가며\n\n파머 펭귄 성별 분류 머신러닝 모델은 인구 관리 및 모니터링을 더 효율적으로 할 수 있기 때문에 중요합니다. 개별 펭귄의 성별을 정확하게 식별함으로써 펭귄 서식지에서 성비와 산란 패턴을 더 잘 이해하고 추적 할 수 있습니다. 이러한 정보는 지구온난화로 인한 기후위기 시대 펭귄생존을 보장하는 데 필수적입니다. 또한 성별 분류 모델은 노동집약적인 성별 식별 업무를 대폭 줄여 시간과 자원을 절약을 효율적으로 사용할 수 있도록 기여합니다.\n\n# 데이터\n\n## 데이터 입수\n\n펭귄 데이터를 입수할 수 있는 방법은 크게 3가지가 있습니다.\n\n- 데이터 패키지\n- 로컬 csv 파일\n- 클라우드 저장소: Microsoft Azure Blob Storage, Google Cloud Storage, DigitalOcean Spaces, Backblaze B2, Wasabi Hot Cloud Storage, Alibaba Cloud OSS, IBM Cloud Object Storage, Oracle Cloud Infrastructure Object Storage, OpenStack Object Storage (Swift), Rackspace Cloud Files\n\n### 데이터 패키지\n\n:::{.panel-tabset}\n\n```bash\n> install.packages('palmerpenguins')\n```\n\n#### R - `palmerpenguins`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(palmerpenguins)\n\npenguins <- palmerpenguins::penguins\n\npenguins\n#> # A tibble: 344 × 8\n#>    species island    bill_length_mm bill_depth_mm flipper_…¹ body_…² sex    year\n#>    <fct>   <fct>              <dbl>         <dbl>      <int>   <int> <fct> <int>\n#>  1 Adelie  Torgersen           39.1          18.7        181    3750 male   2007\n#>  2 Adelie  Torgersen           39.5          17.4        186    3800 fema…  2007\n#>  3 Adelie  Torgersen           40.3          18          195    3250 fema…  2007\n#>  4 Adelie  Torgersen           NA            NA           NA      NA <NA>   2007\n#>  5 Adelie  Torgersen           36.7          19.3        193    3450 fema…  2007\n#>  6 Adelie  Torgersen           39.3          20.6        190    3650 male   2007\n#>  7 Adelie  Torgersen           38.9          17.8        181    3625 fema…  2007\n#>  8 Adelie  Torgersen           39.2          19.6        195    4675 male   2007\n#>  9 Adelie  Torgersen           34.1          18.1        193    3475 <NA>   2007\n#> 10 Adelie  Torgersen           42            20.2        190    4250 <NA>   2007\n#> # … with 334 more rows, and abbreviated variable names ¹​flipper_length_mm,\n#> #   ²​body_mass_g\n```\n:::\n\n\n#### Python - `palmerpenguins`\n\n```bash\n$ pip install palmerpenguins\n```\n\n\n\n::: {.cell}\n\n```{.python .cell-code}\nimport pandas as pd\nfrom palmerpenguins import load_penguins \n\npenguins = load_penguins()\n\npenguins.head()\n#>   species     island  bill_length_mm  ...  body_mass_g     sex  year\n#> 0  Adelie  Torgersen            39.1  ...       3750.0    male  2007\n#> 1  Adelie  Torgersen            39.5  ...       3800.0  female  2007\n#> 2  Adelie  Torgersen            40.3  ...       3250.0  female  2007\n#> 3  Adelie  Torgersen             NaN  ...          NaN     NaN  2007\n#> 4  Adelie  Torgersen            36.7  ...       3450.0  female  2007\n#> \n#> [5 rows x 8 columns]\n```\n:::\n\n\n:::\n\n\n### csv 데이터\n\n:::{.panel-tabset}\n\n#### R - `csv`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\npenguins_csv <- read_csv('data/penguins.csv')\n\npenguins_csv\n#> # A tibble: 344 × 9\n#>    rowid species island    bill_length_mm bill_dep…¹ flipp…² body_…³ sex    year\n#>    <dbl> <chr>   <chr>              <dbl>      <dbl>   <dbl>   <dbl> <chr> <dbl>\n#>  1     1 Adelie  Torgersen           39.1       18.7     181    3750 male   2007\n#>  2     2 Adelie  Torgersen           39.5       17.4     186    3800 fema…  2007\n#>  3     3 Adelie  Torgersen           40.3       18       195    3250 fema…  2007\n#>  4     4 Adelie  Torgersen           NA         NA        NA      NA <NA>   2007\n#>  5     5 Adelie  Torgersen           36.7       19.3     193    3450 fema…  2007\n#>  6     6 Adelie  Torgersen           39.3       20.6     190    3650 male   2007\n#>  7     7 Adelie  Torgersen           38.9       17.8     181    3625 fema…  2007\n#>  8     8 Adelie  Torgersen           39.2       19.6     195    4675 male   2007\n#>  9     9 Adelie  Torgersen           34.1       18.1     193    3475 <NA>   2007\n#> 10    10 Adelie  Torgersen           42         20.2     190    4250 <NA>   2007\n#> # … with 334 more rows, and abbreviated variable names ¹​bill_depth_mm,\n#> #   ²​flipper_length_mm, ³​body_mass_g\n```\n:::\n\n\n\n#### Python - `csv`\n\n\n::: {.cell}\n\n```{.python .cell-code}\nimport pandas as pd\n\npalmer_df = pd.read_csv('data/penguins.csv')\n\nprint(palmer_df.head())\n#>    rowid species     island  ...  body_mass_g     sex  year\n#> 0      1  Adelie  Torgersen  ...       3750.0    male  2007\n#> 1      2  Adelie  Torgersen  ...       3800.0  female  2007\n#> 2      3  Adelie  Torgersen  ...       3250.0  female  2007\n#> 3      4  Adelie  Torgersen  ...          NaN     NaN  2007\n#> 4      5  Adelie  Torgersen  ...       3450.0  female  2007\n#> \n#> [5 rows x 9 columns]\n```\n:::\n\n\n:::\n\n### 클라우드 저장소\n\n:::{.panel-tabset}\n\n#### Onedrive\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(pins)\nlibrary(Microsoft365R)\n\nod <- Microsoft365R::get_personal_onedrive()\nboard <- board_ms365(od, \"krvote_board\")\n# board %>% pin_write(penguins)\n\nboard %>% pin_read(\"penguins\")\n#> # A tibble: 344 × 8\n#>    species island    bill_length_mm bill_depth_mm flipper_…¹ body_…² sex    year\n#>    <fct>   <fct>              <dbl>         <dbl>      <int>   <int> <fct> <int>\n#>  1 Adelie  Torgersen           39.1          18.7        181    3750 male   2007\n#>  2 Adelie  Torgersen           39.5          17.4        186    3800 fema…  2007\n#>  3 Adelie  Torgersen           40.3          18          195    3250 fema…  2007\n#>  4 Adelie  Torgersen           NA            NA           NA      NA <NA>   2007\n#>  5 Adelie  Torgersen           36.7          19.3        193    3450 fema…  2007\n#>  6 Adelie  Torgersen           39.3          20.6        190    3650 male   2007\n#>  7 Adelie  Torgersen           38.9          17.8        181    3625 fema…  2007\n#>  8 Adelie  Torgersen           39.2          19.6        195    4675 male   2007\n#>  9 Adelie  Torgersen           34.1          18.1        193    3475 <NA>   2007\n#> 10 Adelie  Torgersen           42            20.2        190    4250 <NA>   2007\n#> # … with 334 more rows, and abbreviated variable names ¹​flipper_length_mm,\n#> #   ²​body_mass_g\n```\n:::\n\n\n#### AWS S3\n\n#### Google Cloud Storage \n\n:::\n\n# 데이터 전처리\n\n펭귄 데이터는 교육용으로 제공되지만 다른 데이터셋과 달리 결측값(`NA`)도 포함되어 있어 \n본격적인 분석을 위해서 결측값 현황을 정확히 확인하고 결측값에 대한 적절한 전략을 세우고 이를 처리해야 한다.\n\n## 결측값 현황\n\n데이터프레임에 결측값이 어떻게 분포되어 있는지 먼저 시각적으로 파악하자.\n상당수 결측값이 `sex` 칼럼에 몰려있는 것이 확인된다.\n특히, 일부 펭귄의 경우 측정 변수가 모두 결측된 현황도 파악할 수 있다.\n\n\n:::{.panel-tabset}\n\n### 전체 현황\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(naniar)\nlibrary(palmerpenguins)\n\npenguins_raw <- palmerpenguins::penguins\n\nvis_miss(penguins_raw)\n```\n\n::: {.cell-output-display}\n![](penguin_report_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n### 결측값 모아보기\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvis_miss(penguins_raw, cluster = TRUE, sort_miss = TRUE)\n```\n\n::: {.cell-output-display}\n![](penguin_report_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n:::\n\n시각적으로 확인한 후에 기술통계량을 통해 정확한 결측값 현황을 확인해보자.\n\n:::{.panel-tabset}\n\n### 전체 값 수\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnrow(penguins_raw) * ncol(penguins_raw)\n#> [1] 2752\n```\n:::\n\n\n\n### 결측값 수\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnaniar::n_miss(penguins_raw)\n#> [1] 19\n```\n:::\n\n\n### 완전한 값의 수\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnaniar::n_complete(penguins_raw)\n#> [1] 2733\n```\n:::\n\n\n### 변수별 결측값\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmiss_var_summary(penguins_raw)\n#> # A tibble: 8 × 3\n#>   variable          n_miss pct_miss\n#>   <chr>              <int>    <dbl>\n#> 1 sex                   11    3.20 \n#> 2 bill_length_mm         2    0.581\n#> 3 bill_depth_mm          2    0.581\n#> 4 flipper_length_mm      2    0.581\n#> 5 body_mass_g            2    0.581\n#> 6 species                0    0    \n#> 7 island                 0    0    \n#> 8 year                   0    0\n```\n:::\n\n\n\n### 관측점별 결측값\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmiss_case_summary(penguins_raw)\n#> # A tibble: 344 × 3\n#>     case n_miss pct_miss\n#>    <int>  <int>    <dbl>\n#>  1     4      5     62.5\n#>  2   272      5     62.5\n#>  3     9      1     12.5\n#>  4    10      1     12.5\n#>  5    11      1     12.5\n#>  6    12      1     12.5\n#>  7    48      1     12.5\n#>  8   179      1     12.5\n#>  9   219      1     12.5\n#> 10   257      1     12.5\n#> # … with 334 more rows\n```\n:::\n\n\n:::\n\n\n## 결측값 처리 전략\n\n결측값 현황을 살펴보고 결측값이 많은 4번, 272번 펭귄은 분석에서 제거하고 `sex` 암수변수는 범주형 변수라 평균과 유사한 기능을 하는 최빈값(Mode) 정보를 이용하여 결측값을 채워넣는 것으로 한다.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\n# get_mode <- function(x) {\n#   ux <- unique(x)\n#   ux[which.max(tabulate(match(x, ux)))]\n# }\n# \n# get_mode(penguins_csv$sex)\n\npenguins_tbl <- penguins_raw %>% \n  filter( !row_number() %in% c(4, 272) ) %>% \n  mutate( sex = as.character(sex)) %>% \n  mutate( sex = if_else(is.na(sex), \"male\", sex)) %>% \n  mutate( sex = factor( sex, levels = c(\"female\", \"male\")))\n\n```\n:::\n\n\n# 탐색적 데이터 분석\n\n결측값 제거 등을 통해 데이터 전처리 작업이 완료되었다.\n다음 단계로 탐색적 데이터 분석을 통해 암수성별과 관련된 정보를 탐색적으로 파악해보자.\n\n## 기술통계량\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(explore)\n\npenguins_tbl %>% \n  describe()\n#> # A tibble: 8 × 8\n#>   variable          type     na na_pct unique    min   mean    max\n#>   <chr>             <chr> <int>  <dbl>  <int>  <dbl>  <dbl>  <dbl>\n#> 1 species           fct       0      0      3   NA     NA     NA  \n#> 2 island            fct       0      0      3   NA     NA     NA  \n#> 3 bill_length_mm    dbl       0      0    164   32.1   43.9   59.6\n#> 4 bill_depth_mm     dbl       0      0     80   13.1   17.2   21.5\n#> 5 flipper_length_mm int       0      0     55  172    201.   231  \n#> 6 body_mass_g       int       0      0     94 2700   4202.  6300  \n#> 7 sex               fct       0      0      2   NA     NA     NA  \n#> 8 year              int       0      0      3 2007   2008.  2009\n```\n:::\n\n\n\n## 단변량분석\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_tbl %>% \n  explore_all()\n```\n\n::: {.cell-output-display}\n![](penguin_report_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n## 암수(target) 연관성\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_tbl %>% \n  explore_all(target = sex)\n```\n\n::: {.cell-output-display}\n![](penguin_report_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\n## 암수(target) 의사결정나무\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_tbl %>% \n  explain_tree(target = sex)\n```\n\n::: {.cell-output-display}\n![](penguin_report_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n## 시각화\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_tbl %>% \n  explore(body_mass_g, bill_length_mm, target = sex)\n```\n\n::: {.cell-output-display}\n![](penguin_report_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidymodels)\nlibrary(parttree)\n\npenguins_dt <- \n  decision_tree() %>%\n  set_engine(\"rpart\") %>%\n  set_mode(\"classification\") %>%\n  fit(sex ~ body_mass_g + bill_length_mm, data = penguins_tbl)\n\n# 시각화\npenguins_tbl %>%\n  ggplot(aes(x = body_mass_g, y = bill_length_mm)) +\n  # geom_jitter(aes(col=species), alpha=0.7) +\n  geom_point(aes(color = sex)) +\n  geom_parttree(data = penguins_dt, aes(fill=sex), alpha = 0.1,\n                flipaxes = FALSE) +\n  scale_color_manual(values = c(\"female\"  = \"blue\",\n                              \"male\" = \"red\")) +\n  scale_fill_manual(values = c(\"female\"  = \"blue\",\n                              \"male\" = \"red\")) +  \n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](penguin_report_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "penguin_report_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}