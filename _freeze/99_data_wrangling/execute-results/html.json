{
  "hash": "fa5df3c9250d81a2f9c6158f8babd501",
  "result": {
    "markdown": "---\ntitle: \"데이터 전처리 (Preprocessing)\"\ndescription: \"기계학습과 시각화를 위한 다양한 데이터 정제(Cleansing)하는 방법을 다룹니다.\"\ndate: today # 날짜 설정: now, last-modified\nauthor:\n  - name: 이광춘\n    affiliation: TCS\ntitle-block-banner: false\nformat:\n  html:\n    theme: \n      - flatly\n      - css/quarto-fonts.css\n    code-fold: false\n    code-overflow: scroll\n    toc: true\n    toc-depth: 3\n    number-sections: true\n    highlight-style: github    \n    self-contained: false\neditor_options: \n  chunk_output_type: console\nknitr:\n  opts_chunk: \n    collapse: true\n    comment: \"#>\" \n    R.options:\n      knitr.graphics.auto_pdf: true  \n---\n\n\n\n\n\n# 결측값 제거\n\n[참고자료: [결측데이터](https://aispiration.com/data-science/ds-missing.html)]{.aside}\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(palmerpenguins)\n\npenguins\n```\n:::\n\n::: {.cell}\n\n```\n#> # A tibble: 344 × 8\n#>    species island    bill_length_mm bill_depth_mm flipper_…¹ body_…² sex    year\n#>    <fct>   <fct>              <dbl>         <dbl>      <int>   <int> <fct> <int>\n#>  1 Adelie  Torgersen           39.1          18.7        181    3750 male   2007\n#>  2 Adelie  Torgersen           39.5          17.4        186    3800 fema…  2007\n#>  3 Adelie  Torgersen           40.3          18          195    3250 fema…  2007\n#>  4 Adelie  Torgersen           NA            NA           NA      NA <NA>   2007\n#>  5 Adelie  Torgersen           36.7          19.3        193    3450 fema…  2007\n#>  6 Adelie  Torgersen           39.3          20.6        190    3650 male   2007\n#>  7 Adelie  Torgersen           38.9          17.8        181    3625 fema…  2007\n#>  8 Adelie  Torgersen           39.2          19.6        195    4675 male   2007\n#>  9 Adelie  Torgersen           34.1          18.1        193    3475 <NA>   2007\n#> 10 Adelie  Torgersen           42            20.2        190    4250 <NA>   2007\n#> # … with 334 more rows, and abbreviated variable names ¹​flipper_length_mm,\n#> #   ²​body_mass_g\n```\n:::\n\n:::\n\n## 행기준 제거\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(palmerpenguins)\n\npenguins %>% \n  drop_na()\n```\n:::\n\n::: {.cell}\n\n```\n#> # A tibble: 333 × 8\n#>    species island    bill_length_mm bill_depth_mm flipper_…¹ body_…² sex    year\n#>    <fct>   <fct>              <dbl>         <dbl>      <int>   <int> <fct> <int>\n#>  1 Adelie  Torgersen           39.1          18.7        181    3750 male   2007\n#>  2 Adelie  Torgersen           39.5          17.4        186    3800 fema…  2007\n#>  3 Adelie  Torgersen           40.3          18          195    3250 fema…  2007\n#>  4 Adelie  Torgersen           36.7          19.3        193    3450 fema…  2007\n#>  5 Adelie  Torgersen           39.3          20.6        190    3650 male   2007\n#>  6 Adelie  Torgersen           38.9          17.8        181    3625 fema…  2007\n#>  7 Adelie  Torgersen           39.2          19.6        195    4675 male   2007\n#>  8 Adelie  Torgersen           41.1          17.6        182    3200 fema…  2007\n#>  9 Adelie  Torgersen           38.6          21.2        191    3800 male   2007\n#> 10 Adelie  Torgersen           34.6          21.1        198    4400 male   2007\n#> # … with 323 more rows, and abbreviated variable names ¹​flipper_length_mm,\n#> #   ²​body_mass_g\n```\n:::\n\n\n:::\n\n\n## 열기준 제거\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>% \n  select_if(~ !any(is.na(.)))\n```\n:::\n\n::: {.cell}\n\n```\n#> # A tibble: 344 × 3\n#>    species island     year\n#>    <fct>   <fct>     <int>\n#>  1 Adelie  Torgersen  2007\n#>  2 Adelie  Torgersen  2007\n#>  3 Adelie  Torgersen  2007\n#>  4 Adelie  Torgersen  2007\n#>  5 Adelie  Torgersen  2007\n#>  6 Adelie  Torgersen  2007\n#>  7 Adelie  Torgersen  2007\n#>  8 Adelie  Torgersen  2007\n#>  9 Adelie  Torgersen  2007\n#> 10 Adelie  Torgersen  2007\n#> # … with 334 more rows\n```\n:::\n\n\n:::\n\n\n## 결측값 현황\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>% \n  summarise(across(everything(), ~ sum(complete.cases(.)))) %>% \n  pivot_longer( cols = everything(), names_to = \"변수\", values_to = \"정상값\") %>% \n  mutate(결측비율 = 1 - 정상값 / nrow(penguins))\n```\n:::\n\n::: {.cell}\n\n```\n#> # A tibble: 8 × 3\n#>   변수              정상값 결측비율\n#>   <chr>              <int>    <dbl>\n#> 1 species              344  0      \n#> 2 island               344  0      \n#> 3 bill_length_mm       342  0.00581\n#> 4 bill_depth_mm        342  0.00581\n#> 5 flipper_length_mm    342  0.00581\n#> 6 body_mass_g          342  0.00581\n#> 7 sex                  333  0.0320 \n#> 8 year                 344  0\n```\n:::\n\n\n:::\n\n\n# 중복 제거\n\n## 행기준 제거\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_dup <- penguins %>% \n  slice(1:5) %>% \n  bind_rows(penguins %>% slice(1:5))\n\npenguins_dup\n\npenguins_dup %>% \n  distinct()\n```\n:::\n\n::: {.cell}\n\n```\n#> # A tibble: 10 × 8\n#>    species island    bill_length_mm bill_depth_mm flipper_…¹ body_…² sex    year\n#>    <fct>   <fct>              <dbl>         <dbl>      <int>   <int> <fct> <int>\n#>  1 Adelie  Torgersen           39.1          18.7        181    3750 male   2007\n#>  2 Adelie  Torgersen           39.5          17.4        186    3800 fema…  2007\n#>  3 Adelie  Torgersen           40.3          18          195    3250 fema…  2007\n#>  4 Adelie  Torgersen           NA            NA           NA      NA <NA>   2007\n#>  5 Adelie  Torgersen           36.7          19.3        193    3450 fema…  2007\n#>  6 Adelie  Torgersen           39.1          18.7        181    3750 male   2007\n#>  7 Adelie  Torgersen           39.5          17.4        186    3800 fema…  2007\n#>  8 Adelie  Torgersen           40.3          18          195    3250 fema…  2007\n#>  9 Adelie  Torgersen           NA            NA           NA      NA <NA>   2007\n#> 10 Adelie  Torgersen           36.7          19.3        193    3450 fema…  2007\n#> # … with abbreviated variable names ¹​flipper_length_mm, ²​body_mass_g\n#> # A tibble: 5 × 8\n#>   species island    bill_length_mm bill_depth_mm flipper_l…¹ body_…² sex    year\n#>   <fct>   <fct>              <dbl>         <dbl>       <int>   <int> <fct> <int>\n#> 1 Adelie  Torgersen           39.1          18.7         181    3750 male   2007\n#> 2 Adelie  Torgersen           39.5          17.4         186    3800 fema…  2007\n#> 3 Adelie  Torgersen           40.3          18           195    3250 fema…  2007\n#> 4 Adelie  Torgersen           NA            NA            NA      NA <NA>   2007\n#> 5 Adelie  Torgersen           36.7          19.3         193    3450 fema…  2007\n#> # … with abbreviated variable names ¹​flipper_length_mm, ²​body_mass_g\n```\n:::\n\n:::\n\n\n## 열기준 제거\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_cols <- penguins %>% \n  select(1:3) %>% \n  cbind(penguins %>% select(1:3)) \n\npenguins_cols\n\nduplicated_colnames <- duplicated(colnames(penguins_cols))\n\npenguins_cols[!duplicated_colnames] %>% \n  as_tibble()\n```\n:::\n\n::: {.cell}\n\n```\n#> # A tibble: 344 × 3\n#>    species island    bill_length_mm\n#>    <fct>   <fct>              <dbl>\n#>  1 Adelie  Torgersen           39.1\n#>  2 Adelie  Torgersen           39.5\n#>  3 Adelie  Torgersen           40.3\n#>  4 Adelie  Torgersen           NA  \n#>  5 Adelie  Torgersen           36.7\n#>  6 Adelie  Torgersen           39.3\n#>  7 Adelie  Torgersen           38.9\n#>  8 Adelie  Torgersen           39.2\n#>  9 Adelie  Torgersen           34.1\n#> 10 Adelie  Torgersen           42  \n#> # … with 334 more rows\n```\n:::\n\n:::\n\n\n# 자료형 변환\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>% \n  select(species, year, island, bill_length_mm) %>% \n  mutate(year = lubridate::make_date(year = year, month = 7L, day = 1L))\n```\n:::\n\n::: {.cell}\n\n```\n#> # A tibble: 344 × 4\n#>    species year       island    bill_length_mm\n#>    <fct>   <date>     <fct>              <dbl>\n#>  1 Adelie  2007-07-01 Torgersen           39.1\n#>  2 Adelie  2007-07-01 Torgersen           39.5\n#>  3 Adelie  2007-07-01 Torgersen           40.3\n#>  4 Adelie  2007-07-01 Torgersen           NA  \n#>  5 Adelie  2007-07-01 Torgersen           36.7\n#>  6 Adelie  2007-07-01 Torgersen           39.3\n#>  7 Adelie  2007-07-01 Torgersen           38.9\n#>  8 Adelie  2007-07-01 Torgersen           39.2\n#>  9 Adelie  2007-07-01 Torgersen           34.1\n#> 10 Adelie  2007-07-01 Torgersen           42  \n#> # … with 334 more rows\n```\n:::\n\n\n:::\n\n\n# 이상점 제거\n\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguin_stat <- penguins %>% \n  drop_na() %>% \n  summarise(mean = mean(bill_length_mm),\n            sd   = sd(bill_length_mm)) \n\npenguins %>% \n  filter(bill_length_mm < penguin_stat$mean - 2 * penguin_stat$sd |\n         bill_length_mm > penguin_stat$mean + 2 * penguin_stat$sd)\n```\n:::\n\n::: {.cell}\n\n```\n#> # A tibble: 6 × 8\n#>   species   island bill_length_mm bill_depth_mm flipper_le…¹ body_…² sex    year\n#>   <fct>     <fct>           <dbl>         <dbl>        <int>   <int> <fct> <int>\n#> 1 Adelie    Dream            32.1          15.5          188    3050 fema…  2009\n#> 2 Gentoo    Biscoe           59.6          17            230    6050 male   2007\n#> 3 Gentoo    Biscoe           55.9          17            228    5600 male   2009\n#> 4 Gentoo    Biscoe           55.1          16            230    5850 male   2009\n#> 5 Chinstrap Dream            58            17.8          181    3700 fema…  2007\n#> 6 Chinstrap Dream            55.8          19.8          207    4000 male   2009\n#> # … with abbreviated variable names ¹​flipper_length_mm, ²​body_mass_g\n```\n:::\n\n\n:::\n\n# 공백문자제거\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>% \n  mutate(species = str_trim(species))\n```\n:::\n\n::: {.cell}\n\n```\n#> # A tibble: 344 × 8\n#>    species island    bill_length_mm bill_depth_mm flipper_…¹ body_…² sex    year\n#>    <chr>   <fct>              <dbl>         <dbl>      <int>   <int> <fct> <int>\n#>  1 Adelie  Torgersen           39.1          18.7        181    3750 male   2007\n#>  2 Adelie  Torgersen           39.5          17.4        186    3800 fema…  2007\n#>  3 Adelie  Torgersen           40.3          18          195    3250 fema…  2007\n#>  4 Adelie  Torgersen           NA            NA           NA      NA <NA>   2007\n#>  5 Adelie  Torgersen           36.7          19.3        193    3450 fema…  2007\n#>  6 Adelie  Torgersen           39.3          20.6        190    3650 male   2007\n#>  7 Adelie  Torgersen           38.9          17.8        181    3625 fema…  2007\n#>  8 Adelie  Torgersen           39.2          19.6        195    4675 male   2007\n#>  9 Adelie  Torgersen           34.1          18.1        193    3475 <NA>   2007\n#> 10 Adelie  Torgersen           42            20.2        190    4250 <NA>   2007\n#> # … with 334 more rows, and abbreviated variable names ¹​flipper_length_mm,\n#> #   ²​body_mass_g\n```\n:::\n\n\n:::\n\n\n# 칼럼 변환\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>% \n  mutate_if(is.factor, toupper)\n# mutate_if(is.factor, toupper)\n```\n:::\n\n::: {.cell}\n\n```\n#> # A tibble: 344 × 8\n#>    species island    bill_length_mm bill_depth_mm flipper_…¹ body_…² sex    year\n#>    <chr>   <chr>              <dbl>         <dbl>      <int>   <int> <chr> <int>\n#>  1 ADELIE  TORGERSEN           39.1          18.7        181    3750 MALE   2007\n#>  2 ADELIE  TORGERSEN           39.5          17.4        186    3800 FEMA…  2007\n#>  3 ADELIE  TORGERSEN           40.3          18          195    3250 FEMA…  2007\n#>  4 ADELIE  TORGERSEN           NA            NA           NA      NA <NA>   2007\n#>  5 ADELIE  TORGERSEN           36.7          19.3        193    3450 FEMA…  2007\n#>  6 ADELIE  TORGERSEN           39.3          20.6        190    3650 MALE   2007\n#>  7 ADELIE  TORGERSEN           38.9          17.8        181    3625 FEMA…  2007\n#>  8 ADELIE  TORGERSEN           39.2          19.6        195    4675 MALE   2007\n#>  9 ADELIE  TORGERSEN           34.1          18.1        193    3475 <NA>   2007\n#> 10 ADELIE  TORGERSEN           42            20.2        190    4250 <NA>   2007\n#> # … with 334 more rows, and abbreviated variable names ¹​flipper_length_mm,\n#> #   ²​body_mass_g\n```\n:::\n\n\n:::\n\n\n# 특정문자 변환\n\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>% \n  mutate(species_kr = glue::glue(\"{species}_종\")) %>% \n  select(species, species_kr, island)\n```\n:::\n\n::: {.cell}\n\n```\n#> # A tibble: 344 × 3\n#>    species species_kr island   \n#>    <fct>   <glue>     <fct>    \n#>  1 Adelie  Adelie_종  Torgersen\n#>  2 Adelie  Adelie_종  Torgersen\n#>  3 Adelie  Adelie_종  Torgersen\n#>  4 Adelie  Adelie_종  Torgersen\n#>  5 Adelie  Adelie_종  Torgersen\n#>  6 Adelie  Adelie_종  Torgersen\n#>  7 Adelie  Adelie_종  Torgersen\n#>  8 Adelie  Adelie_종  Torgersen\n#>  9 Adelie  Adelie_종  Torgersen\n#> 10 Adelie  Adelie_종  Torgersen\n#> # … with 334 more rows\n```\n:::\n\n\n:::\n\n\n# 결측값 치환\n\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>% \n  mutate(bill_length_mm = ifelse(is.na(bill_length_mm), \n                                 mean(bill_length_mm, na.rm = TRUE),\n                                 bill_length_mm))\n```\n:::\n\n::: {.cell}\n\n```\n#> # A tibble: 344 × 8\n#>    species island    bill_length_mm bill_depth_mm flipper_…¹ body_…² sex    year\n#>    <fct>   <fct>              <dbl>         <dbl>      <int>   <int> <fct> <int>\n#>  1 Adelie  Torgersen           39.1          18.7        181    3750 male   2007\n#>  2 Adelie  Torgersen           39.5          17.4        186    3800 fema…  2007\n#>  3 Adelie  Torgersen           40.3          18          195    3250 fema…  2007\n#>  4 Adelie  Torgersen           43.9          NA           NA      NA <NA>   2007\n#>  5 Adelie  Torgersen           36.7          19.3        193    3450 fema…  2007\n#>  6 Adelie  Torgersen           39.3          20.6        190    3650 male   2007\n#>  7 Adelie  Torgersen           38.9          17.8        181    3625 fema…  2007\n#>  8 Adelie  Torgersen           39.2          19.6        195    4675 male   2007\n#>  9 Adelie  Torgersen           34.1          18.1        193    3475 <NA>   2007\n#> 10 Adelie  Torgersen           42            20.2        190    4250 <NA>   2007\n#> # … with 334 more rows, and abbreviated variable names ¹​flipper_length_mm,\n#> #   ²​body_mass_g\n```\n:::\n\n\n:::\n\n\n# Pivoting\n\n폭넓은 데이터(wide-format data)를 긴 데이터(long-format data)로 혹은 반대로 데이터의 형태를 바꾼다.\n\n## Wide &rarr; Long\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_long <- penguins %>% \n  pivot_longer(cols = contains(\"mm\"), names_to = \"측정변수\", \n               values_to = \"측정값\")\n\npenguins_long\n```\n:::\n\n::: {.cell}\n\n```\n#> # A tibble: 1,032 × 7\n#>    species island    body_mass_g sex     year 측정변수          측정값\n#>    <fct>   <fct>           <int> <fct>  <int> <chr>              <dbl>\n#>  1 Adelie  Torgersen        3750 male    2007 bill_length_mm      39.1\n#>  2 Adelie  Torgersen        3750 male    2007 bill_depth_mm       18.7\n#>  3 Adelie  Torgersen        3750 male    2007 flipper_length_mm  181  \n#>  4 Adelie  Torgersen        3800 female  2007 bill_length_mm      39.5\n#>  5 Adelie  Torgersen        3800 female  2007 bill_depth_mm       17.4\n#>  6 Adelie  Torgersen        3800 female  2007 flipper_length_mm  186  \n#>  7 Adelie  Torgersen        3250 female  2007 bill_length_mm      40.3\n#>  8 Adelie  Torgersen        3250 female  2007 bill_depth_mm       18  \n#>  9 Adelie  Torgersen        3250 female  2007 flipper_length_mm  195  \n#> 10 Adelie  Torgersen          NA <NA>    2007 bill_length_mm      NA  \n#> # … with 1,022 more rows\n```\n:::\n\n\n:::\n\n\n## long &rarr; Wide\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_long %>% \n  pivot_wider(names_from = \"측정변수\", \n              values_from = \"측정값\",\n              values_fn = mean)\n```\n:::\n\n::: {.cell}\n\n```\n#> # A tibble: 284 × 8\n#>    species island    body_mass_g sex     year bill_length_mm bill_dept…¹ flipp…²\n#>    <fct>   <fct>           <int> <fct>  <int>          <dbl>       <dbl>   <dbl>\n#>  1 Adelie  Torgersen        3750 male    2007           39.1        18.7     181\n#>  2 Adelie  Torgersen        3800 female  2007           39.5        17.4     186\n#>  3 Adelie  Torgersen        3250 female  2007           40.3        18       195\n#>  4 Adelie  Torgersen          NA <NA>    2007           NA          NA        NA\n#>  5 Adelie  Torgersen        3450 female  2007           37.7        19.2     194\n#>  6 Adelie  Torgersen        3650 male    2007           39.3        20.6     190\n#>  7 Adelie  Torgersen        3625 female  2007           38.9        17.8     181\n#>  8 Adelie  Torgersen        4675 male    2007           39.2        19.6     195\n#>  9 Adelie  Torgersen        3475 <NA>    2007           34.1        18.1     193\n#> 10 Adelie  Torgersen        4250 <NA>    2007           42          20.2     190\n#> # … with 274 more rows, and abbreviated variable names ¹​bill_depth_mm,\n#> #   ²​flipper_length_mm\n```\n:::\n\n\n:::\n\n\n# 변수 쪼개기\n\n:::{layout-ncol=\"2\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_long %>% \n  separate(측정변수, into = c(\"부위\", \"측정\", \"단위\"), sep = \"_\")\n```\n:::\n\n::: {.cell}\n\n```\n#> # A tibble: 1,032 × 9\n#>    species island    body_mass_g sex     year 부위    측정   단위  측정값\n#>    <fct>   <fct>           <int> <fct>  <int> <chr>   <chr>  <chr>  <dbl>\n#>  1 Adelie  Torgersen        3750 male    2007 bill    length mm      39.1\n#>  2 Adelie  Torgersen        3750 male    2007 bill    depth  mm      18.7\n#>  3 Adelie  Torgersen        3750 male    2007 flipper length mm     181  \n#>  4 Adelie  Torgersen        3800 female  2007 bill    length mm      39.5\n#>  5 Adelie  Torgersen        3800 female  2007 bill    depth  mm      17.4\n#>  6 Adelie  Torgersen        3800 female  2007 flipper length mm     186  \n#>  7 Adelie  Torgersen        3250 female  2007 bill    length mm      40.3\n#>  8 Adelie  Torgersen        3250 female  2007 bill    depth  mm      18  \n#>  9 Adelie  Torgersen        3250 female  2007 flipper length mm     195  \n#> 10 Adelie  Torgersen          NA <NA>    2007 bill    length mm      NA  \n#> # … with 1,022 more rows\n```\n:::\n\n\n:::\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}